suite: test environment variables
templates:
  - deployment.yaml
tests:
  - it: should handle extraEnv variables
    set:
      name: extraenv-app
      enabled: true
      type: deployment
      image:
        repository: app
        tag: "1.0"
      ports:
        - name: http
          containerPort: 8080
      env:
        - name: APP_MODE
          value: production
        - name: LOG_LEVEL
          value: info
      global:
        livenessProbe:
          enabled: false
        readinessProbe:
          enabled: false
      host:
        tz: UTC
        uid: 1000
        gid: 1000
      ingress:
        domain: example.com
      resources:
        enabled: false
      volumePermissions:
        enabled: false
    asserts:
      - matchSnapshot: {}

  - it: should handle environment from secrets
    set:
      name: secret-env-app
      enabled: true
      type: deployment
      image:
        repository: app
        tag: "1.0"
      ports:
        - name: http
          containerPort: 8080
      extraEnvSecrets:
        - name: DATABASE_URL
          secretName: db-credentials
          secretKey: url
        - name: API_KEY
          secretName: api-secrets
          secretKey: key
      global:
        livenessProbe:
          enabled: false
        readinessProbe:
          enabled: false
      host:
        tz: UTC
        uid: 1000
        gid: 1000
      ingress:
        domain: example.com
      resources:
        enabled: false
      volumePermissions:
        enabled: false
    asserts:
      - matchSnapshot: {}

  - it: should handle envFrom ConfigMap
    set:
      name: envfrom-cm-app
      enabled: true
      type: deployment
      image:
        repository: app
        tag: "1.0"
      ports:
        - name: http
          containerPort: 8080
      extraEnvFromCM: app-config
      global:
        livenessProbe:
          enabled: false
        readinessProbe:
          enabled: false
      host:
        tz: UTC
        uid: 1000
        gid: 1000
      ingress:
        domain: example.com
      resources:
        enabled: false
      volumePermissions:
        enabled: false
    asserts:
      - matchSnapshot: {}

  - it: should handle envFrom Secret
    set:
      name: envfrom-secret-app
      enabled: true
      type: deployment
      image:
        repository: app
        tag: "1.0"
      ports:
        - name: http
          containerPort: 8080
      extraEnvFromSecret: app-secrets
      global:
        livenessProbe:
          enabled: false
        readinessProbe:
          enabled: false
      host:
        tz: UTC
        uid: 1000
        gid: 1000
      ingress:
        domain: example.com
      resources:
        enabled: false
      volumePermissions:
        enabled: false
    asserts:
      - matchSnapshot: {}
